<html>
	<head>
		<title>Music Player</title>
	</head>
	<body>
		<table style="width: 100%; height: 100%;">
			<tr>
				<td align="center" valign="middle">

					<span id="text"></span>

					<br /><br /><br />

					<audio id="audio" style="width:600px;" controls></audio>

					<br /><br /><br />

					<input type="button" id="nextButton" value="Next (P)" />

					<br /><br /><br /><br />

					<input type="range" id="speedRange" value="0" min="-100" max="100" step="1" />
					<br />
					<input type="button" id="normalSpeedButton" value="Normal Speed" />

				</td>
			</tr>
		</table>
		<script>

		var list = prompt();

		var script = document.createElement("script");
		script.src = "lists/" + list + ".js";
		document.body.appendChild(script);
		script.onload = function() {

			var audio = document.getElementById("audio");
			var textElem = document.getElementById("text");
			var speedInput = document.getElementById("speedRange");
			var volumeInput = document.getElementById("volumeRange");
			var nextButton = document.getElementById("nextButton");
			var normalSpeedButton = document.getElementById("normalSpeedButton");

			function updateSpeed() {
				audio.playbackRate = Math.pow(2, speedInput.value / 100);
			};
			speedInput.onchange = updateSpeed;

			normalSpeedButton.onclick = function() {
				speedInput.value = 0;
				speedInput.onchange();
			};

			var remaining = [];

			function removeSpaces(str) {
				return str.replace(/\s+/g, "");
			}

			function next() {
				if (remaining.length == 0) {
					for (var i = 0; i < songs.length; i++) {
						remaining.push(songs[i]);
					}
				}
				var index = Math.floor(Math.random() * remaining.length);
				var currentSong = remaining[index];
				audio.src = "files/" + list + "/"
					+ removeSpaces(currentSong.name) + "-"
					+ removeSpaces(currentSong.artist) + ".mp3";
				audio.play();
				updateSpeed();
				textElem.innerHTML = currentSong.name + ", " + currentSong.artist;
				remaining.splice(index, 1);
			}

			next();
			audio.onended = next;
			nextButton.onclick = next;

			window.onkeydown = function(event) {
				var key = (event || window.event).keyCode;
				if (key == 32) {
					if (audio.paused) {
						audio.play();
					} else {
						audio.pause();
					}
				} else if (key == 80) { // p
					next();
				}
			};

		}

		</script>
	</body>
</html>
